## Hotels data merge

Simple application for merging hotel data.

## Stack

* Ruby 2.7.8
* Redis for caching
* Rspec for testing
* ApiDoc for generating documentation

## Installation

### Note:
This is the step install for Macbook.

Install xcode

```
$ xcode-select --install
```

Install `brew` - package management for macOS ([more detail](https://brew.sh))

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

Verify the installation of `brew`

```
$ brew -v
```

#### Setting up dependencies
Install `git, postgres, yarn`

```
$ brew install git yarn postgres
```

Verify the installation of `git, yarn`

```
$ git --version
$ yarn -v
```

Check ruby version of app

```
$ cat .tool-versions
```

Install Ruby. We have many tool for ruby version management such as rbenv, rvm, ... Pick one you prefer. For exmple: you can use `rvm` to manage ruby version ([more detail](https://rvm.io/))

Install `rvm`

```
$ brew install gnupg
$ gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
$ \curl -sSL https://get.rvm.io | bash -s stable
```

Verify the installation of `rvm`

```
$ rvm -v
```

Install and verify ruby version, for example 2.7.8

```
$ rvm install 2.7.8
$ rvm list
```

Clone source code and set up app

```
$ git clone git@github.com:xsieuquay89x/hotels-data-merge.git
$ cd hotels-data-merge
bundle install
```

#### Install redis
Install and config Redis on Mac OS X via Homebrew
```bash
$ brew install redis
```
Starting Redis
```bash
$ redis-server
```
> Test if Redis server is running
```bash
$ redis-cli ping
```
Start Rails server

```bash
bundle exec rails s
```
## Running the application

Simply run the `bundle exec rails s` command to start the Rails server.
The server will start listening on `http://localhost:3000`.

### Requests

- Endpoint `/hotels`
- Method: `POST`
- Description: The API help to collect data from the sources (URLs) and create/update to data on Redis. 

Use Postman, cURL or any other API testing tool to send requests.

Examples:
```
curl -s -H "Content-Type: application/json" -X POST http://localhost:3000/hotels
```

- Endpoint `/hotels`
- Method: `GET`
- Parameter: `id: string array` (Optional)
- Description: The API response the hotel data after merging. It will response all hotels if you don't send `id` on request.

Use Postman, cURL or any other API testing tool to send requests.

Examples:
```
curl -s -H "Content-Type: application/json" -X GET http://localhost:3000/hotels
```

```
curl -s -H "Content-Type: application/json" -X GET http://localhost:3000/hotels?id=iJhz
```

### Response format

The response is an array of JSON objects.

Properties:
* **id** (string)
* **name** (string)
* **destination_id** (number)
* **description** (string)
* **booking_conditions** (string array)
* **amenities** (Object)
    * general (string array)
    * room (string array)
* **images** (Object)
    * amenities (Object array)
        * link (string)
        * description (string)
    * rooms (Object array)
        * link (string)
        * description (string)
    * site (Object array)
        * link (string)
        * description (string)
* **location** (Object)
    * address (string)
    * city (string)
    * country (string)
    * lat (string)
    * lng (string)

### Merging techniques

The reasoning and explanation of merging the individual properties of the hotels:
* id: no merging necessary
* name: the longer name wins
* destination_id: no merging necessary
* description: the longer descriptions wins.
* booking_conditions: booking conditions are trimmed and an array is created with only unique elements
* amenities: spaces are removed from amenities (in order to exclude duplicates like `businesscenter` and `business center`), then arrays are created with only unique elements. Remove the value in `room` if it exists on `general`
* images: each image collections are merged and `link` are made unique to avoid duplication
* location: the non-null value wins, for the `country` property, strings with length of 2 characters are preferred (for country codes like `SG`)

### Testing

To run tests, execute `bundle exec rspec spec` 

### Documentation

##### API docs

To generate API docs: `rake rswag:specs:swaggerize`

Open `api-docs/index.html` to see the documentation generated by Swagger.

### Deployment

Setting up deployment and te## Hotels data merge

Simple application for merging hotel data.

## Stack

* Ruby 2.7.8
* Redis for caching
* Rspec for testing
* ApiDoc for generating documentation

## Installation

### Note:
This is the step install for Macbook.

Install xcode

```
$ xcode-select --install
```

Install `brew` - package management for macOS ([more detail](https://brew.sh))

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

Verify the installation of `brew`

```
$ brew -v
```

#### Setting up dependencies
Install `git, postgres, yarn`

```
$ brew install git yarn postgres
```

Verify the installation of `git, yarn`

```
$ git --version
$ yarn -v
```

Check ruby version of app

```
$ cat .tool-versions
```

Install Ruby. We have many tool for ruby version management such as rbenv, rvm, ... Pick one you prefer. For exmple: you can use `rvm` to manage ruby version ([more detail](https://rvm.io/))

Install `rvm`

```
$ brew install gnupg
$ gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
$ \curl -sSL https://get.rvm.io | bash -s stable
```

Verify the installation of `rvm`

```
$ rvm -v
```

Install and verify ruby version, for example 2.7.8

```
$ rvm install 2.7.8
$ rvm list
```

Clone source code and set up app

```
$ git clone git@github.com:xsieuquay89x/hotels-data-merge.git
$ cd hotels-data-merge
bundle install
```

#### Install redis
Install and config Redis on Mac OS X via Homebrew
```bash
$ brew install redis
```
Starting Redis
```bash
$ redis-server
```
> Test if Redis server is running
```bash
$ redis-cli ping
```
Start Rails server

```bash
bundle exec rails s
```
## Running the application

Simply run the `bundle exec rails s` command to start the Rails server.
The server will start listening on `http://localhost:3000`.

### Requests

- Endpoint `/hotels`
- Method: `POST`
- Description: The API help to collect data from the sources (URLs) and create/update to data on Redis.

Use Postman, cURL or any other API testing tool to send requests.

Examples:
```
curl -s -H "Content-Type: application/json" -X POST http://localhost:3000/hotels
```

- Endpoint `/hotels`
- Method: `GET`
- Parameter: `id: string array` (Optional)
- Description: The API response the hotel data after merging. It will response all hotels if you don't send `id` on request.

Use Postman, cURL or any other API testing tool to send requests.

Examples:
```
curl -s -H "Content-Type: application/json" -X GET http://localhost:3000/hotels
```

```
curl -s -H "Content-Type: application/json" -X GET http://localhost:3000/hotels?id=iJhz
```

### Response format

The response is an array of JSON objects.

Properties:
* **id** (string)
* **name** (string)
* **destination_id** (number)
* **description** (string)
* **booking_conditions** (string array)
* **amenities** (Object)
    * general (string array)
    * room (string array)
* **images** (Object)
    * amenities (Object array)
        * link (string)
        * description (string)
    * rooms (Object array)
        * link (string)
        * description (string)
    * site (Object array)
        * link (string)
        * description (string)
* **location** (Object)
    * address (string)
    * city (string)
    * country (string)
    * lat (string)
    * lng (string)

### Merging techniques

The reasoning and explanation of merging the individual properties of the hotels:
* id: no merging necessary
* name: the longer name wins
* destination_id: no merging necessary
* description: the longer descriptions wins.
* booking_conditions: booking conditions are trimmed and an array is created with only unique elements
* amenities: spaces are removed from amenities (in order to exclude duplicates like `businesscenter` and `business center`), then arrays are created with only unique elements. Remove the value in `room` if it exists on `general`
* images: each image collections are merged and `link` are made unique to avoid duplication
* location: the non-null value wins, for the `country` property, strings with length of 2 characters are preferred (for country codes like `SG`)

### Testing

To run tests, execute `bundle exec rspec spec`

### Documentation

##### API docs

To generate API docs: `rake rswag:specs:swaggerize`

Open `http://localhost:3000/api-docs/index.html` to see the documentation generated by Swagger.

### Deployment

Setting pipelines for a Rails application typically involves using CI/CD (Continuous Integration/Continuous Deployment) tools. One popular choice for CI/CD is GitLab CI/CD, which integrates seamlessly with GitLab repositories. Below, I'll outline a basic guide for setting up CI/CD pipelines for a Rails application using GitLab CI/CD.

- Create a `.gitlab-ci.yml` file in the root of your Rails project. This file defines the CI/CD pipeline stages and jobs.

###Explanation:
- Stages:
    - test: Run tests (e.g., RSpec).
    - deploy: Deploy the application.

- Before Script:
    - Install necessary dependencies (e.g., Bundler) and run bundle install.
    - Test Job (test stage):

- Run RSpec tests.
- Deploy Job (deploy stage):
    - Placeholder for deploying to production. Customize this section based on your deployment process.
- Only on Master:
  - Deploy job is triggered only when changes are pushed to the master branch.

